services:
  design-patterns-mcp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: design-patterns-mcp
    ports:
      - "${HTTP_PORT:-3000}:${HTTP_PORT:-3000}"
    environment:
      - TRANSPORT_MODE=${TRANSPORT_MODE:-http}
      - HTTP_PORT=${HTTP_PORT:-3000}
      - MCP_ENDPOINT=${MCP_ENDPOINT:-/mcp}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - DATABASE_PATH=/app/data/design-patterns.db
      - ENABLE_HYBRID_SEARCH=true
      - ENABLE_GRAPH_AUGMENTATION=true
      - SKIP_DB_SETUP=false
    volumes:
      - design-patterns-data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  design-patterns-data:
    driver: local
